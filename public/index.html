<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAMA RANK CHECKER</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --zama-yellow: #FFD600;
            --zama-black: #050505;
            --zama-grey: #111111;
            --zama-text: #FFFFFF;
            --card-border: #333333;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: var(--zama-black);
            color: var(--zama-text);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        /* --- UI ELEMENTS --- */
        .bg-grid {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(var(--card-border) 1px, transparent 1px),
                linear-gradient(90deg, var(--card-border) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.1; z-index: -1;
        }

        header {
            width: 100%; padding: 30px; display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--zama-yellow); letter-spacing: -1px; }

        main {
            width: 90%; max-width: 1200px;
            display: flex; flex-direction: column; align-items: center;
            padding-top: 40px;
        }

        h1 {
            font-size: clamp(2rem, 5vw, 4rem); font-weight: 900;
            text-align: center; margin-bottom: 40px;
            text-transform: uppercase;
        }
        h1 span { color: var(--zama-yellow); }

        /* --- SEARCH --- */
        .search-container {
            width: 100%; max-width: 600px; margin-bottom: 60px;
            position: relative;
        }

        input {
            width: 100%; padding: 25px; font-size: 1.2rem;
            background: var(--zama-grey); border: 1px solid var(--card-border);
            color: white; border-radius: 12px; font-family: 'JetBrains Mono', monospace;
            outline: none; transition: border 0.3s;
        }
        input:focus { border-color: var(--zama-yellow); }

        .search-btn {
            position: absolute; right: 10px; top: 10px; bottom: 10px;
            background: var(--zama-yellow); color: black; border: none;
            padding: 0 30px; font-weight: 800; border-radius: 8px;
            cursor: pointer; transition: transform 0.2s;
        }
        .search-btn:hover { transform: scale(1.02); }

        /* --- RESULTS --- */
        .results-area { width: 100%; display: none; animation: fadeIn 0.5s; }

        .user-header {
            display: flex; flex-direction: column; align-items: center; margin-bottom: 40px;
        }
        .user-handle { font-size: 2.5rem; font-weight: 900; margin-bottom: 5px; }
        .user-meta { color: #888; font-family: 'JetBrains Mono', monospace; }

        .cards-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px; width: 100%;
        }

        .rank-card {
            background: var(--zama-grey); border: 1px solid var(--card-border);
            border-radius: 16px; padding: 30px;
            display: flex; flex-direction: column; align-items: center;
            position: relative; overflow: hidden;
        }

        /* 30D Card is highlighted */
        .rank-card.primary { border-color: var(--zama-yellow); background: #1a1a10; }

        .card-badge {
            font-size: 0.8rem; font-weight: 800; padding: 5px 12px;
            border-radius: 20px; background: #333; color: #fff;
            margin-bottom: 20px; font-family: 'JetBrains Mono', monospace;
        }
        .rank-card.primary .card-badge { background: var(--zama-yellow); color: black; }

        .rank-value {
            font-size: 3.5rem; font-weight: 900; margin: 10px 0;
            line-height: 1; letter-spacing: -2px;
        }
        .score-row {
            margin-top: 20px; width: 100%; padding-top: 20px;
            border-top: 1px solid #333;
            display: flex; justify-content: space-between;
        }
        .label { color: #666; font-size: 0.9rem; font-weight: 600; text-transform: uppercase; }
        .value { color: var(--zama-yellow); font-family: 'JetBrains Mono', monospace; font-weight: 700; }

        /* --- STATES --- */
        .error-msg {
            color: #ff4444; font-family: 'JetBrains Mono', monospace;
            text-align: center; margin-top: 20px; display: none;
        }
        .loader {
            display: none; width: 40px; height: 40px;
            border: 4px solid #333; border-top-color: var(--zama-yellow);
            border-radius: 50%; animation: spin 1s infinite linear;
            margin: 20px auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <header>
        <div class="logo">ZAMA RANK</div>
    </header>

    <main>
        <h1>Check Your <span>Influence</span></h1>

        <div class="search-container">
            <input type="text" id="handleInput" placeholder="Enter X handle (e.g. @zama_fhe)">
            <button class="search-btn" id="searchBtn">SEARCH</button>
            <div class="loader" id="loader"></div>
            <div class="error-msg" id="errorMsg"></div>
        </div>

        <div class="results-area" id="resultsArea">
            <div class="user-header">
                <div class="user-handle" id="displayHandle">@user</div>
                <div class="user-meta">CREATOR PROGRAM LEADERBOARD</div>
            </div>

            <div class="cards-grid">
                <!-- 24H -->
                <div class="rank-card">
                    <div class="card-badge">24 HOURS</div>
                    <div class="rank-value" id="rank24">#---</div>
                    <div class="score-row">
                        <span class="label">Mindshare</span>
                        <span class="value" id="score24">---</span>
                    </div>
                </div>

                <!-- 30D (Center/Primary) -->
                <div class="rank-card primary">
                    <div class="card-badge">30 DAYS</div>
                    <div class="rank-value" id="rank30">#---</div>
                    <div class="score-row">
                        <span class="label">Mindshare</span>
                        <span class="value" id="score30">---</span>
                    </div>
                </div>

                <!-- 7D -->
                <div class="rank-card">
                    <div class="card-badge">7 DAYS</div>
                    <div class="rank-value" id="rank7">#---</div>
                    <div class="score-row">
                        <span class="label">Mindshare</span>
                        <span class="value" id="score7">---</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const searchBtn = document.getElementById('searchBtn');
        const handleInput = document.getElementById('handleInput');
        const loader = document.getElementById('loader');
        const resultsArea = document.getElementById('resultsArea');
        const errorMsg = document.getElementById('errorMsg');

        searchBtn.addEventListener('click', runSearch);
        handleInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') runSearch() });

        async function runSearch() {
            const handle = handleInput.value.trim().replace('@', '');
            if (!handle) return;

            // Reset UI
            resultsArea.style.display = 'none';
            errorMsg.style.display = 'none';
            loader.style.display = 'block';

            try {
                // Fetch from our Vercel Backend
                const res = await fetch(`/api/rank?handle=${handle}`);
                const data = await res.json();

                loader.style.display = 'none';

                if (data.found) {
                    document.getElementById('displayHandle').innerText = '@' + data.handle;
                    
                    // Update 24H
                    renderCard('rank24', 'score24', data.stats['24h']);
                    // Update 7D
                    renderCard('rank7', 'score7', data.stats['7d']);
                    // Update 30D
                    renderCard('rank30', 'score30', data.stats['30d']);

                    resultsArea.style.display = 'block';
                } else {
                    errorMsg.innerText = "USER NOT FOUND. Ensure they are in the top 1500.";
                    errorMsg.style.display = 'block';
                }

            } catch (e) {
                console.error(e);
                loader.style.display = 'none';
                errorMsg.innerText = "System Error: Could not fetch data.";
                errorMsg.style.display = 'block';
            }
        }

        function renderCard(rankId, scoreId, data) {
            const rEl = document.getElementById(rankId);
            const sEl = document.getElementById(scoreId);
            
            if (data && data.rank && data.rank !== '---') {
                rEl.innerText = '#' + data.rank;
                sEl.innerText = data.score;
            } else {
                rEl.innerText = '---';
                sEl.innerText = '---';
            }
        }
    </script>
</body>
</html>
